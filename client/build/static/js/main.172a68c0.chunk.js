(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{102:function(e,t,c){},103:function(e,t,c){},104:function(e,t,c){},105:function(e,t,c){},106:function(e,t,c){},110:function(e,t,c){"use strict";c.r(t);var a=c(0),s=c(25),n=c.n(s),o=(c(70),c(18)),i=c(3),l=(c(71),c(6)),r=(c(72),c(129)),j=c(128),d=c(126),b=c(127),u=c(39),h=c.n(u),O=c(38),g=c.n(O),m=c(58),f=c.n(m).a.create({base:"http://localhost:5000"}),p=c(5),_=c(1),v=function(){var e=Object(p.b)().loginWithRedirect;return Object(_.jsx)("button",{className:"btn btn-primary btn-block",onClick:function(){return e()},children:"Log In"})},x=function(){var e=Object(p.b)().logout;return Object(_.jsx)("button",{className:"btn btn-danger btn-block",onClick:function(){return e({returnTo:window.location.origin})},children:"Log Out"})},S=function(){return Object(p.b)().isAuthenticated?Object(_.jsx)(x,{}):Object(_.jsx)(v,{})},N=function(){return Object(_.jsx)("div",{className:"navbar-nav ml-auto",children:Object(_.jsx)(S,{})})},k=function(){return Object(_.jsx)("div",{className:"spinner",children:Object(_.jsx)("img",{src:"https://cdn.auth0.com/blog/auth0-react-sample/assets/loading.svg",alt:"Loading..."})})},y=Object(p.c)((function(e){var t=Object(p.b)(),c=t.user,s=(t.isAuthenticated,t.isLoading,e.chatId),n=e.currentChat,o=Object(a.useState)(""),l=Object(i.a)(o,2),u=l[0],O=l[1],m=Object(a.useState)(""),v=Object(i.a)(m,2),x=v[0],S=v[1],k=Object(a.useState)(""),y=Object(i.a)(k,2),C=y[0],I=y[1],w=e.messages;console.log(c),console.log(w);var E=Object(a.useState)(""),U=Object(i.a)(E,2),R=U[0],P=U[1],T=Object(a.useState)({}),A=Object(i.a)(T,2),J=(A[0],A[1]),L=Object(a.useState)(),D=Object(i.a)(L,2),K=D[0],F=D[1];Object(a.useEffect)((function(){B();var e=JSON.parse(localStorage.getItem("currentUser"));console.log(e.picture),J(e),G()}),[]),Object(a.useEffect)((function(){G()}),[n,u,x,C]);var B=function(){void 0===s?(console.log(K),console.log("ChatPage Unlock Failed...No chats exist in this account")):(F(!0),console.log("ChatPage Unlock Successful"))},G=function(){if(console.log(s),void 0===n||null===n)O(""),S("Name"),I("Recently");else{var e=n.picture,t=n.name,c=n.last_login;O(e),S(t),I(c)}};return s?Object(_.jsxs)("div",{className:"chat",children:[Object(_.jsxs)("div",{className:"chat__header",children:[Object(_.jsx)(r.a,{src:u}),Object(_.jsxs)("div",{className:"chat__headerInfo",children:[Object(_.jsx)("h3",{children:x}),Object(_.jsxs)("p",{children:[Object(_.jsx)("h5",{children:"Last Seen: "}),C,"...."]})]}),Object(_.jsxs)("div",{className:"chat__headerRight",children:[Object(_.jsx)(j.a,{children:Object(_.jsx)(d.a,{})}),Object(_.jsx)(j.a,{children:Object(_.jsx)(b.a,{})}),Object(_.jsx)(N,{})]})]}),Object(_.jsx)("div",{className:"chat__body",children:w.map((function(e){return Object(_.jsx)("div",{className:"message__container",children:Object(_.jsxs)("p",{className:"chat__message ".concat(c.name!==e.receivername&&"sender__myself"),children:[Object(_.jsx)("span",{className:"chat__name",children:e.name}),e.message,Object(_.jsx)("span",{className:"chat__timestamp",children:e.timestamp})]})},e._id)}))}),Object(_.jsxs)("div",{className:"chat__footer",children:[Object(_.jsx)(g.a,{}),Object(_.jsxs)("form",{children:[Object(_.jsx)("input",{value:R,onChange:function(e){return P(e.target.value)},placeholder:"type a message",type:"text"}),Object(_.jsx)("button",{onClick:function(e){e.preventDefault();var t=localStorage.getItem("chatid"),a=localStorage.getItem("chatSpecialKey"),s=JSON.parse(localStorage.getItem("currentUser"));console.log(s),console.log(s.displayname),console.log(t),null!==t||""!==t?f.post("/api/messages",{chatid:t,message:R,name:c.name,senderid:c.sub,sndrsdispname:c.nickname,receivername:s.name,receiverspic:s.pic,receiverdispname:s.displayname,chatSpecialKey:a}).then((function(e){P("")})).catch((function(e){return console.log(e)})):alert("Please select an existing chat or start a new one before sending a message")},type:"submit",children:Object(_.jsx)(h.a,{})})]})]})]}):Object(_.jsxs)("div",{className:"chat",children:[Object(_.jsxs)("div",{className:"chat__header",children:[Object(_.jsx)(r.a,{}),Object(_.jsxs)("div",{className:"chat__headerInfo",children:[Object(_.jsx)("h3",{children:"Name"}),Object(_.jsxs)("p",{children:[Object(_.jsx)("h5",{children:"Last Seen: "}),"...."]})]}),Object(_.jsxs)("div",{className:"chat__headerRight",children:[Object(_.jsx)(j.a,{children:Object(_.jsx)(d.a,{})}),Object(_.jsx)(j.a,{children:Object(_.jsx)(b.a,{})}),Object(_.jsx)(N,{})]})]}),Object(_.jsx)("div",{className:"chat__body",children:Object(_.jsx)("h4",{children:"Select an existing conversation or start A New One"})}),Object(_.jsxs)("div",{className:"chat__footer",children:[Object(_.jsx)(g.a,{}),Object(_.jsxs)("form",{children:[Object(_.jsx)("input",{value:R,onChange:function(e){return P(e.target.value)},placeholder:"type a message",type:"text"}),Object(_.jsx)("button",{onClick:function(){alert("You need to select a chat first before sending a message")},type:"submit",children:Object(_.jsx)(h.a,{})})]})]})]})}),{onRedirecting:function(){return Object(_.jsx)(k,{})}}),C=(c(102),c(103),c(40)),I=c.n(C),w=c(42),E=c.n(w),U=c(41),R=c.n(U),P=c(59),T=c.n(P),A=c(60),J=c.n(A);var L=function(e){var t=e.setShow,c=e.chats,s=e.fetchChat,n=e.addNewChat,o=e.blockUser,l=e.chatRejuvinate,d=(e.retrieveUsersChats,e.deleteNow),b=Object(a.useState)(""),u=Object(i.a)(b,2),h=u[0],O=u[1],g=Object(a.useState)(""),m=Object(i.a)(g,2),f=m[0],v=m[1],x=Object(a.useState)(""),S=Object(i.a)(x,2),N=S[0],k=S[1],y=Object(a.useState)(""),C=Object(i.a)(y,2),w=C[0],U=C[1],P=Object(a.useState)(""),A=Object(i.a)(P,2),L=A[0],D=A[1],K=Object(a.useState)(),F=Object(i.a)(K,2),B=F[0],G=F[1],H=Object(a.useState)(""),M=Object(i.a)(H,2),W=M[0],$=M[1],q=Object(a.useState)(""),Q=Object(i.a)(q,2),V=Q[0],X=Q[1],z=Object(a.useState)(""),Y=Object(i.a)(z,2),Z=Y[0],ee=Y[1],te=Object(a.useState)(""),ce=Object(i.a)(te,2),ae=ce[0],se=ce[1],ne=Object(a.useState)(""),oe=Object(i.a)(ne,2),ie=oe[0],le=oe[1],re=Object(a.useState)(""),je=Object(i.a)(re,2),de=je[0],be=je[1],ue=Object(a.useState)(""),he=Object(i.a)(ue,2),Oe=he[0],ge=he[1],me=Object(a.useState)(""),fe=Object(i.a)(me,2),pe=fe[0],_e=fe[1],ve=Object(a.useState)(""),xe=Object(i.a)(ve,2),Se=xe[0],Ne=xe[1],ke=Object(a.useState)(""),ye=Object(i.a)(ke,2),Ce=ye[0],Ie=ye[1],we=Object(a.useState)(""),Ee=Object(i.a)(we,2),Ue=Ee[0],Re=Ee[1],Pe=Object(a.useState)(""),Te=Object(i.a)(Pe,2),Ae=Te[0],Je=Te[1],Le=Object(a.useState)(!1),De=Object(i.a)(Le,2),Ke=De[0],Fe=De[1],Be=Object(a.useState)(!1),Ge=Object(i.a)(Be,2),He=Ge[0],Me=Ge[1],We=Object(p.b)().user,$e=We.picture;console.log(We),Object(a.useEffect)((function(){Qe()}),[V]);var qe=function(){t(!0),n()};Object(a.useEffect)((function(){c===[]||void 0===c?(G(!1),console.log("Sidebar Unlock Failed...No chats exist in this account")):(G(!0),console.log("Sidebar Unlock Successful"))}),[]),Object(a.useEffect)((function(){!0===Ke&&(console.log(Ae),function(){console.log(Ae),localStorage.setItem("selectedDel",JSON.stringify(Ae));var e=localStorage.getItem("selectedDel");console.log(e),console.log("delete function run without being called again"),d(),Fe(!1)}())}),[Ke]),Object(a.useEffect)((function(){if(!0===He){var e=JSON.parse(localStorage.getItem("selectedBlock"));console.log(e),function(e){var t={blocker_id:Z,blocker_name:ie,blockee_id:ae,blockee_name:de,blocker_mail:Oe,blockee_mail:pe,blocker_dispName:Ce,blockee_dispName:Ue,chatSpecialKey:Se};console.log(t);var c=localStorage.setItem("selectedBlock",JSON.stringify(t));console.log(c),o()}()}}),[He]);var Qe=function(){console.log(c);localStorage.setItem("chatid",JSON.stringify(h));var e=localStorage.setItem("chatSpecialKey",JSON.stringify(W)),t=localStorage.getItem("chatid");console.log(t);var a={userid:f,name:N,displayname:w,mail:L,chatspecialkey:e,picture:V},n=(localStorage.setItem("currentUser",JSON.stringify(a)),localStorage.getItem("chatid")),o=localStorage.getItem("chatSecretKey");console.log(a),console.log("chatid: ".concat(n,", specialkey: ").concat(o)),l(),s()};return B?Object(_.jsxs)("div",{className:"sidebar",children:[Object(_.jsxs)("div",{className:"sidebar__header",children:[Object(_.jsx)(r.a,{src:$e}),Object(_.jsxs)("div",{className:"sidebar__headerRight",children:[Object(_.jsx)(j.a,{children:Object(_.jsx)(I.a,{onClick:function(){return qe()}})}),Object(_.jsx)(j.a,{children:Object(_.jsx)(R.a,{})})]})]}),Object(_.jsx)("div",{className:"sidebar__search",children:Object(_.jsxs)("div",{className:"sidebar__searchContainer",children:[Object(_.jsx)(j.a,{children:Object(_.jsx)(E.a,{})}),Object(_.jsx)("input",{placeholder:"Search conversations",type:"text"})]})}),Object(_.jsx)("div",{className:"sidebar__chats",children:c.map((function(e){return Object(_.jsxs)("div",{className:"sidebarChat ".concat(!0===e.blocked&&"sidebar__blockedChat"),value:h,id:e._id,children:[Object(_.jsx)("div",{className:"sidebarChat__left",children:Object(_.jsx)(r.a,{src:"".concat(e.recptdispPic)})}),Object(_.jsxs)("div",{className:"sidebarChat__info",onClick:function(t){O(e._id),v(e.recpt_id),k(e.recpt_name),U(e.recptdispName),D(e.recpt_mail),$(e.specialkey),X(e.recptdispPic)},children:[Object(_.jsx)("h2",{children:e.recptdispName}),Object(_.jsx)("p",{children:e.recpt_mail})]}),Object(_.jsxs)("div",{className:"sidebarChat__right",children:[Object(_.jsx)("span",{value:Ae,id:e.specialkey,className:"chat__trash",children:Object(_.jsx)(T.a,{onClick:function(t){console.log(e.specialkey),Je(e.specialkey),Fe(!0)}})}),Object(_.jsxs)("span",{id:e._id,className:"chat__block",children:[" ",Object(_.jsx)(J.a,{onClick:function(t){console.log("this is the id of who you just blocked: ".concat(e.recpt_id)),ee(e.sndrs_id),se(e.recpt_id),le(e.sndrs_name),be(e.recpt_name),ge(e.sndrs_mail),_e(e.recpt_mail),Ie(e.sndrsdispName),Re(e.recptdispName),Ne(e.specialkey),Me(!0)}})," "]})]})]},e._id)}))})]}):Object(_.jsxs)("div",{className:"sidebar",children:[Object(_.jsxs)("div",{className:"sidebar__header",children:[Object(_.jsx)(r.a,{src:$e}),Object(_.jsxs)("div",{className:"sidebar__headerRight",children:[Object(_.jsx)(j.a,{children:Object(_.jsx)(I.a,{onClick:function(){return qe()}})}),Object(_.jsx)(j.a,{children:Object(_.jsx)(R.a,{})})]})]}),Object(_.jsx)("div",{className:"sidebar__search",children:Object(_.jsxs)("div",{className:"sidebar__searchContainer",children:[Object(_.jsx)(j.a,{children:Object(_.jsx)(E.a,{})}),Object(_.jsx)("input",{placeholder:"Search conversations",type:"text"})]})}),Object(_.jsx)("div",{className:"sidebar__chats sidebar__emptyChat",children:Object(_.jsx)("h3",{className:"empty__message",children:"Click The New Message Icon To Start a New Conversation"})})]})},D=(c(104),function(e){var t=e.chats,c=e.contactlist,s=e.selectUser,n=Object(p.b)().user,o=Object(a.useState)(""),l=Object(i.a)(o,2),j=l[0],d=l[1],b=Object(a.useState)(""),u=Object(i.a)(b,2),h=u[0],O=u[1],g=Object(a.useState)(""),m=Object(i.a)(g,2),f=m[0],v=m[1],x=Object(a.useState)(""),S=Object(i.a)(x,2),N=S[0],k=S[1],y=Object(a.useState)(""),C=Object(i.a)(y,2),I=C[0],w=C[1],E=Object(a.useState)({}),U=Object(i.a)(E,2),R=U[0],P=U[1];return Object(a.useEffect)((function(){(void 0!==t||""!==j&&""!==h&&""!==f&&""!==N)&&function(){console.log("starting secure deets");var e={recpt_id:j,recpt_name:h,sndrs_id:n.sub,sndrs_name:n.name,recpt_mail:f,sndrs_mail:n.email,recptdispName:N,recptPicture:I,sndrsdispName:n.nickname,sndrsPicture:n.picture,secretKey:"'on its way",last_mesge:"",numofmsges:0};console.log(e),P(e),console.log(R);var t=localStorage.getItem("selectedUser");console.log("this is the previous saved user: ".concat(t)),localStorage.removeItem("selectedUser"),localStorage.setItem("selectedUser",JSON.stringify(e)),s()}()}),[j,h,f,N]),e.show?Object(_.jsx)("div",{className:"modal__wrapper",onClick:function(){e.switchOff()},children:Object(_.jsx)("div",{className:"modal__inner",children:Object(_.jsx)("div",{className:"modal__body",style:{zIndex:1},children:c.map((function(e){return Object(_.jsxs)("div",{className:"user__select",onClick:function(){d("".concat(e.user_id)),v("".concat(e.email)),O("".concat(e.name)),k("".concat(e.nickname)),w("".concat(e.picture))},children:[Object(_.jsx)(r.a,{src:"".concat(e.picture)}),Object(_.jsxs)("span",{children:["$",e.name]})]},e.user_id)}))})})}):null}),K=function(){var e=Object(p.b)().loginWithRedirect;return Object(_.jsx)("button",{className:"btn btn-primary btn-block",onClick:function(){return e({screen_hint:"signup"})},children:"Sign Up"})};c(105),c(106);var F=function(){return Object(_.jsx)("div",{className:"login__body",children:Object(_.jsxs)("div",{className:"login__inner",children:[Object(_.jsx)("div",{className:"login__header",children:Object(_.jsx)("h4",{children:"Welcome To Opus Messenger"})}),Object(_.jsx)("div",{className:"login__button",children:Object(_.jsx)(v,{})}),Object(_.jsx)("div",{className:"signup__button",children:Object(_.jsx)(K,{})})]})})},B=c(61),G=c.n(B),H=c(62),M=c(4),W=function(e){var t=e.component,c=Object(M.a)(e,["component"]);return Object(_.jsx)(l.a,Object(H.a)({component:Object(p.c)(t,{onRedirecting:function(){return Object(_.jsx)(k,{})}})},c))};var $=function(){var e=Object(p.b)(),t=e.user,c=e.isAuthenticated,s=(e.isLoading,Object(a.useState)()),n=Object(i.a)(s,2),r=n[0],j=n[1],d=Object(a.useState)([]),b=Object(i.a)(d,2),u=b[0],h=b[1],O=Object(a.useState)(!1),g=Object(i.a)(O,2),m=g[0],v=g[1],x=Object(a.useState)(""),S=Object(i.a)(x,2),N=S[0],k=S[1],C=Object(a.useState)([]),I=Object(i.a)(C,2),w=I[0],E=I[1],U=Object(a.useState)([]),R=Object(i.a)(U,2),P=R[0],T=R[1],A=Object(a.useState)({}),J=Object(i.a)(A,2),K=(J[0],J[1]),B=Object(a.useState)([]),H=Object(i.a)(B,2),M=(H[0],H[1],Object(a.useState)({name:"Name",picutue:"",last_login:"today"})),$=Object(i.a)(M,2),q=$[0],Q=$[1];Object(a.useEffect)((function(){console.log(t),Q([{picture:"",name:"",last_login:""}]),void 0===t||t===[]?K(t):(Q([{picture:"",name:"",last_login:""}]),localStorage.setItem("user",JSON.stringify(t)),console.log(t),X())}),[p.b,t]);var V=function(){var e=JSON.parse(localStorage.getItem("currentUser")),t=localStorage.getItem("chatid");console.log(t),k(t),console.log(e);var c=e.userid;console.log(c),f.get("api/users/sync").then((function(e){console.log(e);var t=e.data;console.log(t);var a;a=t.find((function(e){return e.user_id===c})),console.log(a),Q(a),console.log(q),localStorage.setItem("currentChat",JSON.stringify(a))})).catch((function(e){return console.log(e)}))};Object(a.useEffect)((function(){console.log(q)}),[q]);var X=function(){var e=t;console.log(e);var c=e.sub;console.log(c),f.get("api/chats/chat/".concat(c)).then((function(e){console.log(e.data),E(e.data);var t=e.data[0];console.log(t),localStorage.setItem("currentChat",JSON.stringify(t))})).catch((function(e){return console.log("there was an API Error : ".concat(e))}))},z=function(){var e=localStorage.getItem("chatid"),t=localStorage.getItem("chatSpecialKey");console.log(e),console.log(t),null!==t||t!==[]||""!==t?f.get("/api/messages/chat/".concat(t)).then((function(t){if(200===t.status){console.log(t);var c=t.data;console.log(c),T(c),k(e),console.log(P)}else console.log("there was a problem retrieving the messages for this chat, trying checking if the user is submitted")})).catch():console.log("No chat id was detected")};return Object(a.useEffect)((function(){var e=new G.a("0d81b56dcdff3b8a813c",{cluster:"mt1"}),t=e.subscribe("messages"),c=e.subscribe("chats");return t.bind("inserted",(function(e){T([].concat(Object(o.a)(P),[e])),console.log(e)})),c.bind("inserted",(function(e){E([].concat(Object(o.a)(w),[e])),console.log(e),z()})),function(){t.unbind_all(),t.unsubscribe(),c.unbind_all(),c.unsubscribe()}}),[P,w]),console.log(P),console.log(w),c?Object(_.jsx)("div",{className:"app",children:Object(_.jsx)("div",{className:"app__body",children:Object(_.jsx)(l.c,{children:Object(_.jsxs)(W,{exact:!0,path:"/",component:y,children:[Object(_.jsx)(D,{contactlist:u,show:r,setShow:j,switchOff:function(){j(null)},selectUser:function(){var e=JSON.parse(localStorage.getItem("selectedUser"));e?(console.log(e),f.post("api/chats/",{options:e}).then((function(e){console.log(e.data),localStorage.removeItem("selectedUser");var t=e.data._id;e.data.recptdispName;console.log(t)})).catch((function(e){return console.log(e)}))):alert("Please select a user")}}),Object(_.jsx)(L,{chatid:N,setChatId:k,chatRejuvinate:V,retrieveUsersChats:X,blockUser:function(){var e=JSON.parse(localStorage.getItem("selectedBlock"));console.log(e),f.post("api/users/block/",{options:e}).then((function(e){console.log(e);var t=e.data,c=t.id,a=t.name;console.log("alright so these are new blockeeid: ".concat(c," and their name is ").concat(a)),alert("Blocked")})).catch((function(e){return console.log("Block Attempt Failed")}))},chats:w,user:t,show:r,setShow:j,addNewChat:function(){var e=JSON.parse(localStorage.getItem("user"));console.log(e);var t=e.sub;console.log(t);var c=t;f.get("api/users/set/".concat(c)).then((function(e){var c=e.data;if(console.log(c),c!==[])f.get("api/users/sync").then((function(e){var c=e.data,a=c.filter((function(e){return e.user_id!==t}));console.log(c),h(a)}));else{var a=c.reduce((function(e,t){return e.concat(t.blocker_id)}),[]);console.log(a),f.get("api/users/sync").then((function(e){console.log(a);var c=e.data;console.log(c);for(var s=function(e){var s=a[e],n=c.filter((function(e){return e.user_id!==s&&e.user_id!==t}));console.log(n),h(n)},n=0;n<a.length;n++)s(n)}))}}))},fetchChat:z,contactlist:u,deleteNow:function(){var e=localStorage.getItem("selectedDel");console.log(e);var t=e.replace(/^"(.*)"$/,"$1");f.delete("api/chats/".concat(t)).then((function(e){console.log(e),alert(e.data),X()}))},gotId:m,setGotId:v}),Object(_.jsx)(y,{chatId:N,setChatId:k,chatRejuvinate:V,currentChat:q,messages:P,user:t,chats:w,setMessages:T})]})})})}):Object(_.jsx)(F,{})},q=function(e){e&&e instanceof Function&&c.e(3).then(c.bind(null,130)).then((function(t){var c=t.getCLS,a=t.getFID,s=t.getFCP,n=t.getLCP,o=t.getTTFB;c(e),a(e),s(e),n(e),o(e)}))},Q=c(29),V=function(e){var t=e.children,c=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_AUTH0_CLIENT_ID:"2QgGJbypCmkbqX5wEpE3h7rOMOKUhGGp",REACT_APP_AUTH0_DOMAIN:"dev--fe2sg9v.us.auth0.com",REACT_APP_SERVER_URL:"http://localhost:5000"}).REACT_APP_AUTH0_AUDIENCE,a=Object(l.f)();return Object(_.jsx)(p.a,{domain:"dev--fe2sg9v.us.auth0.com",clientId:"2QgGJbypCmkbqX5wEpE3h7rOMOKUhGGp",redirectUri:window.location.origin,onRedirectCallback:function(e){a.push((null===e||void 0===e?void 0:e.returnTo)||window.location.pathname)},audience:c,children:t})};n.a.render(Object(_.jsx)(Q.a,{children:Object(_.jsx)(V,{children:Object(_.jsx)($,{})})}),document.getElementById("root")),q()},70:function(e,t,c){},71:function(e,t,c){},72:function(e,t,c){}},[[110,1,2]]]);
//# sourceMappingURL=main.172a68c0.chunk.js.map